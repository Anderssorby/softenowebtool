<?php/** * */class ImageSelect extends Div {	protected $reader;	protected $start;	protected $show;	protected $albums;	protected $script;	protected $list;	function __construct($start = 0, $show = "") {		parent::__construct("img-chooser");		$this -> reader = new DataReader("bilder", $start, 12);		$this -> start = $start;		$this -> show = $show;		$this->generateId();		$this->addChild($this->script = new script(""));		if ($old) {			$this -> makeAjaxOldVersion();		} else {			$this -> makeSimpleIFrameVersion();		}	}	protected function makeHeader() {		$header = new Div("img-chooser-head");		$header -> addChild("Viser ".($this->start+1)." til " . ($this -> start + 12));		$this -> addChild($header);		$form = new Form("?site=bilder&start=".$this->start, false);		$form -> class = "inline";		$albsel = new chooser("", "show", "", true);		$form -> addChild($albsel);		$form -> addChild(new Button("Oppdater", "", true));		$header -> addChild($form);		$albsel -> addOption("Alle bilder", "");		$alred = new DataReader("album");		$alred -> readHead();		$alred -> read();		$this -> albums = array();		foreach ($alred->data as $a) {			$isin = false;			foreach ($this->albums as $key => $al) {				if ($key == $a[0]) {					$isin = true;					$this->albums[$key][] = $a[1];				}			}			if (!$isin) {				$this->albums[$a[0]] = array($a[1]);				$op = $albsel -> addOption($a[0], $a[0]);				if ($a[0] == $this->show) {					$op -> selected = "true";				}			}		}	}	protected function makeSimpleIFrameVersion() {		$this->makeHeader();		$this->list = $list = new HtmlList("");		$list->generateId();		$this->script->addChild('$(function() {$("#'.$list->id.'").selectable();});');		foreach ($this->reader->rowid as $i => $id) {			if (isset($this->albums[$this -> show])) {				$isin = false;				foreach ($this->albums[$this->show] as $key => $bid) {					if ($bid == $id) {						$isin = true;						break;					}				}			} else {				$isin = true;			}			if ($isin) {				$frame = new Div("img-chooser-frame", "img-choos-" . $i);				$frame -> addChild($ifr = new Div("img-chooser-wrap"));				$ifr -> addChild($img = new Img($id, $id));				$img -> style = "max-height: 70px; max-width: 80px;";				$title = new HtmlElement("span");				$title -> addChild($this -> reader -> data[$i][1]);				$frame -> addChild($title);				$slett = new InteractElement("?site=bilder&action=slettbilde&id=".$id, "slett", true);				$frame -> addChild($slett);				$list -> add($frame);						}		}		$this -> addChild($list);		$for = $this -> start - 12;		if ($for >= 0)		$this -> addChild($pre = new InteractElement("?site=bilder&start=" . $for, "Forrige"));		$this -> addChild($nes = new InteractElement("?site=bilder&start=" . ($this -> start + 12), "Neste"));		$this -> addChild($form = new Form("?site=bilder&action=lastbilde", false));		$form -> id = "upform";		$last = new Input("file", "fil");		$last -> accept = "image/*";		$last -> multiple = "true";		$lbut = new Button("Last opp", "", true);		$form -> addChild($last);		$form -> addChild($lbut);	}	public function asDialog($sel) {		$this->script->addChild('$(function() {			$("#'.$this->id.'").dialog({			autoOpen: false,			buttons: {"Ok": function() {				$("#'.$sel.'").val($("#'.$this->list->id.' .ui-selected").first().find("img").attr("src"));			$(this).dialog("close");		 }, "Avbryt": function() { $(this).dialog("close"); }				 },			show: "slide",			modal: true,			width: 560		});		});');;	}}